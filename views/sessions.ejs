<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>My Climbing Sessions</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body class="body climb-body">
    <%- include('partials/header') %>
    <div class="site-panel">
        <h1 class="site-title">My Sessions</h1>

        <% if (Array.isArray(climbs) && climbs.length) { %>
            <%
            // Group climbs by date (normalize to date only, ignoring time)
            const climbsByDate = {};
            climbs.forEach(function(climb) {
                const date = new Date(climb.date_climbed);
                // Create date key as YYYY-MM-DD to group by day only
                const dateKey = date.getFullYear() + '-' + 
                               String(date.getMonth() + 1).padStart(2, '0') + '-' + 
                               String(date.getDate()).padStart(2, '0');
                if (!climbsByDate[dateKey]) {
                    climbsByDate[dateKey] = [];
                }
                climbsByDate[dateKey].push(climb);
            });
            
            // Sort dates in descending order (most recent first)
            const sortedDates = Object.keys(climbsByDate).sort((a, b) => new Date(b) - new Date(a));
            %>

            <div class="session-grid">
                <% sortedDates.forEach(function(date) { %>
                    <div class="session-card">
                        <h2 class="session-card-title">Session on <%= new Date(date).toLocaleDateString('en-GB', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></h2>
                        <table class="session-table session-table-dark">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Difficulty</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% climbsByDate[date].forEach(function(climb) { %>
                                    <tr>
                                        <td><%= climb.climb_name %></td>
                                        <td><%= climb.difficulty %></td>
                                        <td><%= new Date(climb.date_climbed).toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit', hour12: false }) %></td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% }); %>
            </div>
        <% } else { %>
            <p class="site-lead">No climbing sessions found.</p>
        <% } %>

        <div class="site-separator">
            <p class="site-forum-link"><a href="/">Back to home</a></p>
        </div>
    </div>
</body>
</html>
